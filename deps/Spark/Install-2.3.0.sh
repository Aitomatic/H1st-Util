#!/usr/bin/env bash


DOWNLOAD_URL=http://mirrors.ocf.berkeley.edu/apache/spark/spark-2.3.0/spark-2.3.0-bin-hadoop2.7.tgz
DOWNLOAD_COMPRESSED_FILE_NAME=spark-2.3.0-bin-hadoop2.7.tgz
DOWNLOAD_DIR_NAME=spark-2.3.0-bin-hadoop2.7

OPT_DIR_PATH=/opt
TARGET_SPARK_DIR_NAME=spark

SPARK_CONF_DIR_NAME=conf
SPARK_CONF_FILE_NAME=spark-defaults.conf

TMP_DIR_PATH=/tmp


wget $DOWNLOAD_URL --output-document $TMP_DIR_PATH/$DOWNLOAD_COMPRESSED_FILE_NAME
tar -C $TMP_DIR_PATH -xf $TMP_DIR_PATH/$DOWNLOAD_COMPRESSED_FILE_NAME


if [ -d $OPT_DIR_PATH/$DOWNLOAD_DIR_NAME ]; then
  rsync --archive --delete $TMP_DIR_PATH/$DOWNLOAD_DIR_NAME/ $OPT_DIR_PATH/$DOWNLOAD_DIR_NAME
  rm -r $TMP_DIR_PATH/$DOWNLOAD_DIR_NAME

else
  mv $TMP_DIR_PATH/$DOWNLOAD_DIR_NAME $OPT_DIR_PATH/$DOWNLOAD_DIR_NAME

fi


cp $OPT_DIR_PATH/$SPARK_CONF_FILE_NAME $OPT_DIR_PATH/$DOWNLOAD_DIR_NAME/$SPARK_CONF_DIR_NAME/$SPARK_CONF_FILE_NAME

rm $OPT_DIR_PATH/$TARGET_SPARK_DIR_NAME
ln -s $OPT_DIR_PATH/$DOWNLOAD_DIR_NAME $OPT_DIR_PATH/$TARGET_SPARK_DIR_NAME
